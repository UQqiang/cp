<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title></title>
    <!-- rev-hash -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- end -->

    <!--rev-hash -->
    <link href="../style/css/order.css" rel="stylesheet" type="text/css">
    <!--end -->

</head>

<body class="nav-md">
<div class="container body">
    <div class="main_container">
        @@include('common/sidebar.html')
        @@include('common/header.html')

        <!-- page content -->
        <div class="right_col" role="main">
            <div class="x_panel">
                <div class="x_title">
                    <h2><small></small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li class="fr">
                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <div id="orderDetail"></div>
                </div>
            </div>
            <div class="x_panel">
                <div class="x_title">
                    <h2><small></small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li class="fr">
                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <div id="orderLogistic"></div>
                </div>
            </div>
            <div class="x_panel">
                <div class="x_title">
                    <h2><small></small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li class="fr">
                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <div id="orderList"></div>
                </div>
            </div>

        </div>
        <!-- /page content -->

        @@include('common/footer.html')

    </div>
</div>

<!-- rev-hash -->
<!-- inject:js -->
<!-- endinject -->
<!-- end -->

 <!--rev-hash -->
<script src="../src/fn/order-detail.js"></script>
 <!--end -->

<script type="text/template" id="j-template">
    <div id="wizard" class="form_wizard wizard_horizontal">
        <ul class="wizard_steps">
            <li>
                <a href="javascript:;" class="<%if(items.order_time){%><%='done'%><%}else{%><%='disabled'%><%}%>">
                    <span class="step_no">1</span>
                    <span class="step_descr">买家下单<br/>
                        <small><%= items.order_time %></small>
                    </span>
                </a>
            </li>
            <li>
                <a href="javascript:;" class="<%if(items.pay_time){%><%='done'%><%}else{%><%='disabled'%><%}%>">
                    <span class="step_no">2</span>
                    <span class="step_descr">买家付款<br/>
                        <small><%= items.pay_time || items.order_time + '以后' %></small>
                    </span>
                </a>
            </li>
            <li>
                <a href="javascript:;" class="<%if(items.delivery_time){%><%='done'%><%}else{%><%='disabled'%><%}%>">
                    <span class="step_no">3</span>
                    <span class="step_descr">商家发货<br/>
                        <small><%= items.delivery_time || items.pay_time + '以后' %></small>
                    </span>
                </a>
            </li>
        </ul>
    </div>
    <div id="order">
        <div class="form-group">
            <label class="ui-label ui-label-md tr">订单编号：</label>
            <span><%= items.order_sn %></span>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">订单状态：</label>
            <span><%= orderStatus[items.order_status] %></span>
            <% if( items.order_status == 30 ){ %>
            <span>
                <a class="j-send-goods btn btn-sm btn-success" data-order_id="<%= items.id %>" data-user_id="<%= items.user_id %>" data-refund_mark="<%= items.refund_mark %>" data-orderinfo="<%= encodeURIComponent(JSON.stringify(items)) %>">发货</a>
            </span>
            <% } %>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">付款方式：</label>
            <span><%= payment[items.payment_id] %></span>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">买家昵称：</label>
            <span><%= items.order_items[0].user_name %></span>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">买家留言：</label>
            <span><%= items.user_memo || '暂无留言' %></span>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">身份证：</label>
            <span><%= items.order_consignee_d_t_o.id_card_no %></span>
        </div>
        <div class="form-group">
            <label class="ui-label ui-label-md tr">收货信息：</label>
            <span>
                <%=items.order_consignee_d_t_o.province%>
                <%=items.order_consignee_d_t_o.city%>
                <%=items.order_consignee_d_t_o.area%>
                <%=items.order_consignee_d_t_o.address%>
                &nbsp;&nbsp;&nbsp;<%=items.order_consignee_d_t_o.consignee%>
                &nbsp;&nbsp;&nbsp;<%=items.order_consignee_d_t_o.mobile%>
            </span>
        </div>
    </div>
</script>

<!-- 物流信息 -->
<script type="text/template" id="j-template-logistic">
    <% if( items && items.length > 0 ){ %>
    <div class="col-xs-3">
        <ul class="nav nav-tabs tabs-left" role="tablist">
            <% _.each(items,function(item,index){ %>
                <% if( index == 0 ){ %>
                <li role="presentation" class="active">
                    <a href="#logistic-<%= index + 1 %>" role="tab" data-toggle="tab" aria-expanded="true">包裹&nbsp;-&nbsp;<%= index + 1 %></a>
                </li>
                <% }else{ %>
                <li role="presentation">
                    <a href="#logistic-<%= index + 1 %>" role="tab" data-toggle="tab" aria-expanded="false">包裹&nbsp;-&nbsp;<%= index + 1 %></a>
                </li>
                <% } %>
            <% }) %>
        </ul>
    </div>
    <div class="col-xs-9 tab-content">
        <% _.each(items,function(item,index){ %>
            <div class="tab-pane fade <% if( index == 0 ){ %> in active <%} %>" id="logistic-<%= index + 1 %>" role="tabpanel">
                <p class="lead parcel-title"><i class="fa fa-gift"></i>&nbsp;&nbsp;包裹&nbsp;-&nbsp;<%= index + 1 %></p>
                <div class="parcel-info">
                    <% _.each(item.order_item_list,function(o,i){ %>
                    <p>商品名称：<%= o.item_name %> <%= o.item_sku_desc %> * <%= o.number %></p>
                    <% }) %>
                    <% if( item.express_no != undefined ){ %>
                    <p>发货方式：快递</p>
                    <% } %>
                    <% if(item.express != undefined) { %>
                    <p>物流公司：<%= item.express %></p>
                    <% } %>
                    <% if(item.express_no != undefined){ %>
                    <span>物流单号：<%= item.express_no%></span>
                    <% } %>
                    <span>
                        <% if(item.editable == 0){ %>
                        <!--<a href="javascript:;" class="btn btn-sm btn-success j-change-logistic" data-value="{{= item.id}}">修改物流信息</a>-->
                        <% } %>
                    <span>
                </div>
                <% if( item.thirdparty_list == undefined || item.thirdparty_list.length < 1 ){ %>
                    <span class="mt10 inl-bl">暂无物流跟踪信息！</span>
                <% }else{ %>
                    <% _.each(item.thirdparty_list,function(o,i){ %>
                        <div class="thirdparty-list">
                            <span class="cycle"></span>
                            <div class="logistic-content">
                                <p class="border-line logistic-time"><%= o.time %></p>
                                <p class="logistic-detail"><%= o.context %></p>
                            </div>
                        </div>
                    <% }) %>
                <% } %>
            </div>
        <% }) %>
    </div>
    <% }else{ %>
    <p class="tc">该物流公司暂未返回跟踪信息，你可以前往 <a href="http://www.kuaidi100.com/" class="blue" target="_blank">快递网站查询</a> 或联系其公司电话</p>
    <% } %>
</script>

<!-- 订单列表 -->
<script type="text/template" id="j-template-order">
    <table class="table table-bordered">
        <thead class="order-header">
        <tr>
            <th class="tc"><span>商品</span></th>
            <th class="tc"><span>单价(元)</span></th>
            <th class="tc"><span>数量</span></th>
            <th class="tc"><span>小计(元)</span></th>
            <th class="tc">状态</th>
            <th class="tc">优惠</th>
            <th class="tc">余额抵现</th>
            <th class="tc">积分抵现</th>
            <th class="tc">改价</th>
            <th class="tc">运费</th>
            <th class="tc">税费</th>
        </tr>
        </thead>
        <tbody>
        <% _.each(item.order_items,function(o,i){ %>
        <% if( o.item_type != 11 ){ %>
        <tr>
            <td class="cell-40">
                <dl>
                    <dt><img class="order-image" src="<%= o.item_image_url %>"></dt>
                    <dd>
                        <p><%= o.item_name %></p>
                        <p class="sku"><%= o.item_sku_desc %></p>
                    </dd>
                </dl>
            </td>
            <td class="cell-5"><span><%= o.unit_price_str %></span></td>
            <td class="cell-5 tc"><span><%= o.number %></span></td>
            <td class="cell-5 tc"><span><%= ((o.unit_price * o.number)/100).toFixed(2) %></span></td>
            <td class="cell-10 tc">
                <% if( o.refund_status == 1 || o.refund_status == 2 ){ %>
                <a href="./order-refund.html?order_id=<%=o.order_id%>&user_id=<%=o.user_id%>&order_item_id=<%= o.original_order_item_id ==undefined ? o.id : o.original_order_item_id%>" class="ui-button ui-button-sblue">请查看退款维权</a>
                <% }else if( o.refund_status == 4 ){ %>
                <span>退款完成</span>
                <% }else if( o.refund_status == 3 && o.delivery_mark == 0 ){ %>
                <span>未发货</span>
                <% }else if( o.refund_status == 3 && o.delivery_mark == 1 ){ %>
                <span>已发货</span>
                <% }else if( o.refund_status == undefined && o.delivery_mark == 0 ){ %>
                <span>未发货</span>
                <% }else if( o.refund_status == undefined && o.delivery_mark == 1 ){ %>
                <span>已发货</span>
                <% } %>
            </td>
            <% if( i == 0 ){ %>
            <td class="cell-5 tc" rowspan="<%= item.order_items.length %>">
                <span><%= (item.discount_amount/100).toFixed(2) %></span>
            </td>
            <td class="cell-5 tc" rowspan="<%= item.order_items.length %>">
                <span><%= ((item.vouchers_discount_amount ? item.vouchers_discount_amount : 0)/100).toFixed(2) %></span>
            </td>
            <td class="cell-10 tc" rowspan="<%= item.order_items.length %>">
                <p><%= (item.point_discount_amount == undefined ? 0 : item.point_discount_amount/100).toFixed(2) %></p>
                <p>(使用<%= item.point == undefined ? 0 : item.point %>个积分)</p>
            </td>
            <td class="cell-5 tc" rowspan="<%= item.order_items.length %>">
                <span><%= (item.floating_price == undefined ? 0 : (item.floating_price/100).toFixed(2)) %></span>
            </td>
            <td class="cell-5 tc" rowspan="<%= item.order_items.length %>">
                <span><%= (item.delivery_fee/100).toFixed(2) %></span>
            </td>
            <td class="cell-5 tc" rowspan="<%= item.order_items.length %>">
                <span><%= (item.tax_fee/100).toFixed(2) || 0 %></span>
            </td>
            <% } %>
        </tr>
        <% } %>

        <% }) %>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="17" class="tr">应收总价：<%= item.total_amount %>&nbsp;元</td>
            </tr>
        </tfoot>
    </table>
</script>

<!-- 发货 -->
<script type="text/template" id="j-template-send-goods">
    <table class="table table-bordered">
        <thead class="order-header">
        <tr>
            <th class="tc cell-10"> <input type="checkbox" id="check-all" class="flat"></th>
            <th class="tc cell-50"><span>商品</span></th>
            <th class="tc cell-10"><span>数量</span></th>
            <th class="tc cell-10"><span>物流公司</span></th>
            <th class="tc cell-20"><span>快递单号</span></th>
        </tr>
        </thead>
        <tbody>
        <% _.each(item.order_items,function(o,i){ %>
        <% if( o.item_type != 11 ){ %>
        <tr>
            <td class="tc">
                <% if( o.delivery_mark != 1 ){ %>
                <input type="checkbox" class="checkbox flat" data-mark="<%= o.delivery_mark || 0 %>" data-id="<%= o.id %>">
                <% }else{ %>
                <span>已发货</span>
                <% } %>
            </td>
            <td>
                <dl>
                    <dt><img style="width:60px;height: 60px;" src="<%= o.item_image_url %>"></dt>
                    <dd>
                        <p><%= o.item_name %></p>
                        <p class="sku"><%= o.item_sku_desc %></p>
                    </dd>
                </dl>
            </td>
            <td class="tc"><span><%= o.number %></span></td>
            <td class="tc"><span>-</span></td>
            <td class="tc"><span>-</span></td>
        </tr>
        <% } %>
        <% }) %>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="5">
                <div class="form-group">
                    <label class="ui-label ui-label-md">收货地址：</label>
                    <span><%= item.order_consignee_d_t_o.province %><%= item.order_consignee_d_t_o.city %><%= item.order_consignee_d_t_o.area %><%= item.order_consignee_d_t_o.address %></span>
                </div>
                <div class="form-group">
                    <label class="ui-label ui-label-md">发货方式：</label>
                    <label><input type="radio" name="logistics" class="flat" checked="checked" data-value="1">&nbsp;需要物流</label>
                    <label><input type="radio" name="logistics" class="flat" data-value="0">&nbsp;无需物流</label>
                </div>
                <div class="form-group logistics-info">
                    <label class="ui-label ui-label-md">物流公司：</label>
                    <select class="form-control form-control-lg" id="logisticsList">
                        <option value="">请选择物流公司</option>
                    </select>
                </div>
                <div class="form-group logistics-info">
                    <label class="ui-label ui-label-md">物流单号：</label>
                    <input class="form-control form-control-lg" id="logisticCode">
                </div>
            </td>
        </tr>
        </tfoot>
    </table>
</script>

<!-- 物流公司 -->
<script type="text/template" id="j-template-logistics">
    <option>请选择物流公司</option>
    <% _.each(items,function(item,index){ %>
    <option value="<%= item.code %>"><%= item.name %></option>
    <% }) %>
</script>
</body>
</html>
